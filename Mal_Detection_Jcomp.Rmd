---
title: "Mal_Det"
author: "Nithyasri_20MIA1017"
date: "2024-04-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
# Load necessary libraries
library(dplyr)
library(caret)
library(xgboost)
```

```{r}
mydata<-read.csv("MalwareSamples10000.csv")
df = subset(mydata, select = -c(specimenId) )
```

```{r}
# Perform basic data exploration
head(df)
summary(df)
```

```{r}
# Preprocessing
# One-hot encoding for the 'isMalware' column
df <- mutate(df, isMalware = ifelse(isMalware == "Yes", 1, 0))
```

```{r}
###To replace Nan value with 0
ind <- rowSums(is.na(df)) == ncol(df)
ind
```


```{r}
########Process the data for machine learning algorithms
procdata <- data.frame(as.numeric(as.factor(df$hasExe)),
                       as.numeric(as.factor(df$hasZip)),
                       as.numeric(as.factor(df$hasPDF)),
                       as.numeric(as.factor(df$hasDoc)),
                       as.numeric(as.factor(df$hasUnknown)),
                       as.numeric(as.factor(df$hasURL)),
                       as.numeric(df$urlCount),
                       as.numeric(df$totalEmailSizeBytes),
                       as.numeric(as.factor(df$senderDomainSuffix)),
                       as.numeric(df$headerCount),
                       as.numeric(df$isMalware))
                       
colnames(procdata) <- c("hasExe", "hasZip", "hasPDF", "hasDoc", 
                        "hasUnknown", "hasURL","urlCount","totalEmailSizeBytes" ,"senderDomainSuffix","headerCount","isMalware")

#procdata$isMalware <- ifelse(procdata$isMalware == "Yes", 1, 0)
#procdata$isMalware <- factor(procdata$isMalware, levels = c(0, 1))
```



```{r}
# Split the data into training and testing sets (80% training, 20% testing)
set.seed(123)  # for reproducibility
train_index <- createDataPartition(procdata$isMalware, p = 0.8, list = FALSE)
train_data <- procdata[train_index, ]
test_data <- procdata[-train_index, ]
```


*QDA model
```{r}
# Load necessary library
library(MASS)

# Train QDA model
qda_model <- qda(isMalware ~ ., data = train_data)

# Make predictions on the testing data
predictions_qda <- predict(qda_model, newdata = test_data)

# Extract predicted classes
predictions_qda_class <- predictions_qda$class
#predictions_qda_class <- as.factor(predictions_qda_class)
# Evaluate the QDA model using confusion matrix
confusionMatrix(predictions_qda_class, as.factor(test_data$isMalware))

```




*Naive bayes
```{r}
library(naivebayes)
train_data$isMalware <- as.factor(train_data$isMalware)
# Model 5: Naive Bayes
nb_model <- naive_bayes(isMalware ~ ., data = train_data)
# Model 5: Naive Bayes
predictions_nb <- predict(nb_model, newdata = test_data)
```

```{r}
confusionMatrix(predictions_nb, as.factor(test_data$isMalware))
```
```{r}
library(naivebayes)
train_data$isMalware <- as.factor(train_data$isMalware)
# Model 5: Naive Bayes
nb_model <- naive_bayes(isMalware ~ ., data = train_data)
# Model 5: Naive Bayes
```

```{r}
confusionMatrix(predictions_nb, as.factor(test_data$isMalware))
```

```{r}
predictions_nb <- predict(nb_model, newdata = test_data)
```

```{r}
predictions_ensemble_binary
test_data$isMalware
```

```{r}

```



```{r}
#Testing
testing<-read.csv("EmailSamples50000(2).csv")
dat = subset(testing, select = -c(specimenId) )
#To replace Nan value with 0
ind <- rowSums(is.na(dat)) == ncol(dat)
ind
set.seed(456)
#Process the data for machine learning algorithms predictions
proctest <- data.frame(as.numeric(as.factor(dat$hasExe)),
                       as.numeric(as.factor(dat$hasZip)),
                       as.numeric(as.factor(dat$hasPDF)),
                       as.numeric(as.factor(dat$hasDoc)),
                       as.numeric(as.factor(dat$hasUnknown)),
                       as.numeric(as.factor(dat$hasURL)),
                       as.numeric(dat$urlCount),
                       as.numeric(dat$totalEmailSizeBytes),
                       as.numeric(as.factor(dat$senderDomainSuffix)),
                       as.numeric(dat$headerCount),
                       dat$isMalware)

colnames(proctest) <- c("hasExe", "hasZip", "hasPDF", "hasDoc", 
                        "hasUnknown", "hasURL","urlCount","totalEmailSizeBytes" ,"senderDomainSuffix","headerCount","isMalware")
proctest <- mutate(proctest, isMalware = ifelse(isMalware == "Yes", 1, 0))
proctest$isMalware <- as.factor(proctest$isMalware)
#proctest$isMalware <- factor(proctest$isMalware, levels = c(0, 1))
```
```{r}
#QDA model
predictions_qda <- predict(qda_model, newdata = proctest)
predictions_qda_class <- predictions_qda$class

predictions_qda_class

```